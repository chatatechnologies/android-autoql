<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1.0, user-scalable=no">
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://d3js.org/d3.v6.min.js"></script>
<title></title>
<style>
	body, table, th{
		background: #3b3f46!important;
		color: #ffffff!important;
  }
	table {
		padding-top: 0px!important;
	}
	th {
		position: sticky;
		top: 0px;
		z-index: 10;
		padding: 10px 3px 5px 3px;
	}
	table {
		font-size: 16px;
		display: table;
		min-width: 100%;
		white-space: nowrap;
		border-collapse: separate;
		border-spacing: 0px!important;
		border-color: grey;
	}
	tr td:first-child {
		text-align: center;
	}
	td {
		padding: 3px;
		text-align: center!important;
  }
	td, th {
		font-size: 16px;
		max-width: 200px;
		white-space: nowrap;
		width: 50px;
		overflow: hidden;
		text-overflow: ellipsis;
		border: 0.5px solid #cccccc;
  }
  /*border for svg*/
  svg {
    border: 1px solid #aaa;
    /*width: 100%;
    position: relative;
    height: 100%;
    z-index: 0;*/
  }
	tfoot {
    /*display: table-header-group;*/
		display: none;
  }
  .button {
    border: none;
    color: white;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
  }
</style>
</head>
<body>

	<div style="display: none;">
    <button class="button" onclick="updateData(TypeEnum.TABLE)">TABLE</button>
    <!-- <button class="button" onclick="updateData(TypeEnum.PIVOT)">PIVOT</button> -->
    <button class="button" onclick="updateData(TypeEnum.COLUMN)">COLUMN</button>
    <button class="button" onclick="updateData(TypeEnum.BAR)">BAR</button>
    <button class="button" onclick="updateData(TypeEnum.LINE)">LINE</button>
    <button class="button" onclick="updateData(TypeEnum.PIE)">PIE</button>
    <!-- <button class="button" onclick="updateData(TypeEnum.HEATMAP)">HEATMAP</button> -->
    <!-- <button class="button" onclick="updateData(TypeEnum.BUBBLE)">BUBBLE</button> -->
    <!-- <button class="button" onclick="updateData(TypeEnum.STACKED_BAR)">STACKED BAR</button> -->
    <!-- <button class="button" onclick="updateData(TypeEnum.STACKED_COLUMN)">STACKED COLUMN</button> -->
    <!-- <button class="button" onclick="updateData(TypeEnum.STACKED_AREA)">STACKED AREA</button> -->
  </div>
		
<table id="idTableBasic"><thead><tr><th>Element</th><th>Available</th><th>Inactive</th><th>Item</th><th>Stocked</th><th>Item Type</th><th>Cost</th><th>Quantity (Cost)</th><th>Rate (Cost)</th><th>Ticket Division</th><th>Invoice</th><th>Line Number</th><th>Revenue</th><th>Quantity (Revenue)</th><th>Rate (Revenue)</th><th>(Ticket Detail) State</th><th>Ticket Type</th><th>Date Created</th><th>Date</th><th>Ticket Type ID</th><th>Ticket Total Amount</th></tr></thead><tfoot><tr><th>Element</th><th>Available</th><th>Inactive</th><th>Item</th><th>Stocked</th><th>Item Type</th><th>Cost</th><th>Quantity (Cost)</th><th>Rate (Cost)</th><th>Ticket Division</th><th>Invoice</th><th>Line Number</th><th>Revenue</th><th>Quantity (Revenue)</th><th>Rate (Revenue)</th><th>(Ticket Detail) State</th><th>Ticket Type</th><th>Date Created</th><th>Date</th><th>Ticket Type ID</th><th>Ticket Total Amount</th></tr></tfoot><tbody><tr><td>Other</td><td>0</td><td>0</td><td>1 Ton and Trailer Paving</td><td>0</td><td>Revenue</td><td>$0.00</td><td>0</td><td>$0.00</td><td>????????</td><td>NotInvoiced</td><td>1</td><td>$100.00</td><td>1</td><td>$100.00</td><td>Update</td><td>Ticket</td><td>2 de Jun de 2021</td><td>2 de Jun de 2021</td><td>Ticket</td><td>$100.00</td></tr><tr><td>Other</td><td>0</td><td>0</td><td>Bobcat/Skidsteer Paving</td><td>0</td><td>Revenue</td><td>$0.00</td><td>0</td><td>$0.00</td><td>????????</td><td>NotInvoiced</td><td>1</td><td>$240.00</td><td>12</td><td>$20.00</td><td>Posted</td><td>Ticket</td><td>14 de Ene de 2021</td><td>14 de Ene de 2021</td><td>Ticket</td><td>$240.00</td></tr><tr><td>Other</td><td>0</td><td>0</td><td>Bobcat/Skidsteer Grading</td><td>0</td><td>Revenue</td><td>$0.00</td><td>0</td><td>$0.00</td><td>????????</td><td>NotInvoiced</td><td>2</td><td>$200.00</td><td>10</td><td>$20.00</td><td>Hold</td><td>Ticket</td><td>14 de Ene de 2021</td><td>14 de Ene de 2021</td><td>Ticket</td><td>$840.00</td></tr><tr><td>Other</td><td>0</td><td>0</td><td>Bobcat/Skidsteer Concrete</td><td>0</td><td>Revenue</td><td>$0.00</td><td>0</td><td>$0.00</td><td>????????</td><td>NotInvoiced</td><td>3</td><td>$200.00</td><td>10</td><td>$20.00</td><td>Hold</td><td>Ticket</td><td>14 de Ene de 2021</td><td>14 de Ene de 2021</td><td>Ticket</td><td>$840.00</td></tr><tr><td>Other</td><td>0</td><td>0</td><td>Bobcat/Skidsteer Paving</td><td>0</td><td>Revenue</td><td>$0.00</td><td>0</td><td>$0.00</td><td>????????</td><td>NotInvoiced</td><td>1</td><td>$240.00</td><td>12</td><td>$20.00</td><td>Hold</td><td>Ticket</td><td>14 de Ene de 2021</td><td>14 de Ene de 2021</td><td>Ticket</td><td>$840.00</td></tr><tr><td>Other</td><td>0</td><td>0</td><td>Grader Concrete</td><td>0</td><td>Revenue</td><td>$0.00</td><td>0</td><td>$0.00</td><td>????????</td><td>NotInvoiced</td><td>4</td><td>$200.00</td><td>10</td><td>$20.00</td><td>Hold</td><td>Ticket</td><td>14 de Ene de 2021</td><td>14 de Ene de 2021</td><td>Ticket</td><td>$840.00</td></tr><tr><td>Other</td><td>0</td><td>0</td><td>Bobcat/Skidsteer Grading</td><td>0</td><td>Revenue</td><td>$0.00</td><td>0</td><td>$0.00</td><td>????????</td><td>NotInvoiced</td><td>2</td><td>$200.00</td><td>10</td><td>$20.00</td><td>Update</td><td>Ticket</td><td>13 de Ene de 2021</td><td>13 de Ene de 2021</td><td>Ticket</td><td>$600.00</td></tr><tr><td>Other</td><td>0</td><td>0</td><td>Bobcat/Skidsteer Concrete</td><td>0</td><td>Revenue</td><td>$0.00</td><td>0</td><td>$0.00</td><td>????????</td><td>NotInvoiced</td><td>3</td><td>$200.00</td><td>10</td><td>$20.00</td><td>Update</td><td>Ticket</td><td>13 de Ene de 2021</td><td>13 de Ene de 2021</td><td>Ticket</td><td>$600.00</td></tr><tr><td>Other</td><td>0</td><td>0</td><td>Bobcat/Skidsteer Paving</td><td>0</td><td>Revenue</td><td>$0.00</td><td>0</td><td>$0.00</td><td>????????</td><td>NotInvoiced</td><td>1</td><td>$200.00</td><td>10</td><td>$20.00</td><td>Update</td><td>Ticket</td><td>13 de Ene de 2021</td><td>13 de Ene de 2021</td><td>Ticket</td><td>$600.00</td></tr><tr><td>Other</td><td>0</td><td>0</td><td>Bobcat/Skidsteer Grading</td><td>0</td><td>Revenue</td><td>$0.00</td><td>0</td><td>$0.00</td><td>????????</td><td>NotInvoiced</td><td>2</td><td>$200.00</td><td>10</td><td>$20.00</td><td>Hold</td><td>Ticket</td><td>13 de Ene de 2021</td><td>13 de Ene de 2021</td><td>Ticket</td><td>$600.00</td></tr><tr><td>Other</td><td>0</td><td>0</td><td>Bobcat/Skidsteer Concrete</td><td>0</td><td>Revenue</td><td>$0.00</td><td>0</td><td>$0.00</td><td>????????</td><td>NotInvoiced</td><td>3</td><td>$200.00</td><td>10</td><td>$20.00</td><td>Hold</td><td>Ticket</td><td>13 de Ene de 2021</td><td>13 de Ene de 2021</td><td>Ticket</td><td>$600.00</td></tr><tr><td>Other</td><td>0</td><td>0</td><td>Bobcat/Skidsteer Paving</td><td>0</td><td>Revenue</td><td>$0.00</td><td>0</td><td>$0.00</td><td>????????</td><td>NotInvoiced</td><td>1</td><td>$200.00</td><td>10</td><td>$20.00</td><td>Hold</td><td>Ticket</td><td>13 de Ene de 2021</td><td>13 de Ene de 2021</td><td>Ticket</td><td>$600.00</td></tr></tbody></table>

<script>
function getFirst10(string) {
  var newString = '';
  if (string.length < 11) {
    newString = string;
  } else {
    newString = string.substring(0, 10) + '...';
  }
  return newString;
}

function digitsCount(n) {
	var count = 0;
	if ( n >= 1) ++count;

	while (n/ 10 >= 1) {
		n /= 10;
		++count;
	}
	return count;
}

function angle(d) {
	var a = (d.startAngle + d.endAngle) * 90 / Math.PI - 90;
	return a > 90 ? a - 180 : a;
}

function isHorizontal(type) {
  return (type == TypeEnum.BAR);
}

function clearSvg() {
	//remove svg
	d3.select('svg').remove();
}

function updateSize() {
  if (data.length < 8) {
    width = $(window).width() - margin.left - margin.right;
  } else {
    var width1 = $(window).width() - margin.left - margin.right;
    width = (width1 / 8) * data.length;
  }
  height = $(window).height() - margin.top - margin.bottom;
  radius = Math.min(width, height) / 2;
}

function isMultiple(typeChart) {
  return nColumns > 3 && (typeChart == TypeEnum.BAR || typeChart == TypeEnum.COLUMN || typeChart == TypeEnum.LINE);
}

function updateData(tmpChart, isReload) {
  //region set nColumns
  var keys = Object.keys(data[0]);
  nColumns = keys.length;
  //endregion
	var _isMultiple = isMultiple(tmpChart);
	if (dataTmp.length && (isAgain || _isMultiple))
  {
		if (_isMultiple)
      typeChart = tmpChart;
    isAgain = false;
  }
  else
  {
    dataTmp = [];
		var aTmp = getDataMulti();
    aTmp.forEach(element => {
			var copied = Object.assign({}, element);
			indexIgnore.forEach(index => {
        delete copied[`time_${index}`];
      });
			dataTmp.push(copied);
		});
		if (typeChart != tmpChart || isReload) {
      typeChart = tmpChart;
    }
  }

  updateSize();
  //region choose table or chart
  switch (tmpChart) {
    case TypeEnum.TABLE:
    case TypeEnum.PIVOT:
      $("svg").hide(0);
      var aID = tmpChart == TypeEnum.TABLE ? ["idTableBasic", "idTableDataPivot"] : ["idTableDataPivot", "idTableBasic"];
      $(`#${aID[0]}`).show(0);
      $(`#${aID[1]}`).hide(0);
      break;
    default:
      $("#idTableBasic").hide(0);
      $("#idTableDataPivot").hide(0);
      clearSvg();
      switch(typeChart) {
        case TypeEnum.COLUMN:
          if (nColumns == 2) {
            setColumn();
          } else {
            setMultiColumn();
          }
        break;
        case TypeEnum.BAR:
          if (nColumns == 2) {
              setBar();
            } else {
              setMultiBar();
            }
          break;
        case TypeEnum.LINE:
          if (nColumns == 2) {
            setLine();
          } else {
            setMultiLine();
          }
          break;
        case TypeEnum.PIE:
          setDonut();
          break;
      }
      break;
  }
  //endregion
}

function drillDown(content) {
	try {
		Android.boundMethod(content);
	} catch(err) {
		console.log("Good content: " + content);
	};
}

function modalCategories(type, content) {
  try {
		Android.modalCategories(type, content);
	} catch(err) {
		console.log(`Good content: ${content}; ${type}`);
	};
}

function getAxisX() {
  var extra = '';
  if (nColumns > 3) {
    extra = '▼';
  }
  return `${axisX} ${extra}`;
}

function getAxisY() {
  var extra = '';
  if (nColumns > 3) {
    extra = '▼';
  }
  return `${axisY} ${extra}`;
}

function svgMulti() {
  var svg = d3.select('body').append('svg')
		.attr('width', width + margin.bottom + margin.right)
		.attr('height', height + margin.top + margin.left + 50);
  return svg;
}

function addText(svg, textAnchor, fontSize, rotate, x, y, fillColor, id, text, click) {
  svg.append('text')
		.attr('text-anchor', textAnchor)
		.style('font-size', fontSize)
    .attr('transform', `rotate(${rotate})`)
		.attr('x', x)//for center
		.attr('y', y)//for set on bottom with -10
		.attr('fill', fillColor)
		.attr('id', id)
		.text(text)
    .on('click', click);
}

function addCircle(svg, cx, cy, r, fill, id, fStyle, fClick) {
  svg.append('circle')
    .attr('cx', cx)
    .attr('cy', cy)
    .attr('r', r)
    .attr('fill', fill)
    .attr('id', id)
    .attr('style', fStyle)
    .on('click', fClick);
}

function splitAxis(x) {
  return `${x.split('_')[0]}`;
}

function formatAxis(y) {
  return `${fformat(y)}`;
}

function axisMulti(svg, isLeft, xBand, height, _tickSize, formatAxis) {
  var svg = svg.append("g");
  if (height !== undefined)
  {
    svg = svg.attr('transform', `translate(0,${height})`)
  }
  var axis = isLeft ? d3.axisLeft(xBand) : d3.axisBottom(xBand);
  axis = axis.tickSize(_tickSize).tickFormat(x => formatAxis(x));
	svg.call(axis);
  return svg;
}

function completeAxisMultiple(axis, pointX, pointY, rotate) {
  axis
    .selectAll('text')
    //rotate text
    .attr('transform', `translate(${pointX}, ${pointY})rotate(${rotate})`)
    //Set color each item on X axis
    .attr('fill', '#909090')
    .style('text-anchor', 'end');
}

function setMultiCategory(aIndex, _IsCurrency, onlyIndex) {
	if (onlyIndex !== undefined) {
    var aTmp = _IsCurrency ? aCategory : aCategory2;
    axisY = aTmp[onlyIndex];
  } else {
    axisY = _IsCurrency ? 'Amount' : 'Quantity';
  }
  indexIgnore = [];
  aIndex.forEach(index => {
    indexIgnore.push(index);
  });
	isCurrency = _IsCurrency;
  dataTmp = [];
  updateData(typeChart, true);
}

//region not mutable
const TypeEnum = Object.freeze({
  "TABLE": 1,
  "PIVOT": 2,
  "COLUMN": 3,
  "BAR": 4,
  "LINE": 5,
  "PIE": 6,
  "HEATMAP": 7,
  "BUBBLE": 8,
  "STACKED_BAR": 9,
  "STACKED_COLUMN": 10,
  "STACKED_AREA": 11,
  "UNKNOWN": 0});
	
const TypeManage = Object.freeze({
  'SELECTABLE': 'SELECTABLE',
  'PLAIN': 'PLAIN'
});

var colorPie = ["#26a7e9", "#a5cd39", "#dd6a6a", "#ffa700", "#00c1b2"];
var colorBi = ['#26a7e9'];//Main color for bars

var axisX = 'Date Created';
var axisY = 'Amount';
var nColumns = 0;

//Main data
var dataTmp = [];
var data = [{name: '2 de Jun de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 100.0, time_3: 100.0, time_4: 100.0},
{name: '14 de Ene de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 240.0, time_3: 20.0, time_4: 240.0},
{name: '14 de Ene de 2021_2', time_0: 0.0, time_1: 0.0, time_2: 840.0, time_3: 80.0, time_4: 3360.0},
{name: '13 de Ene de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 600.0, time_3: 60.0, time_4: 1800.0},
{name: '13 de Ene de 2021_2', time_0: 0.0, time_1: 0.0, time_2: 600.0, time_3: 60.0, time_4: 1800.0}];
var data2 = [{name: '2 de Jun de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 0.0, time_3: 0.0, time_4: 1.0, time_5: 1.0},
{name: '14 de Ene de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 0.0, time_3: 0.0, time_4: 1.0, time_5: 12.0},
{name: '14 de Ene de 2021_2', time_0: 0.0, time_1: 0.0, time_2: 0.0, time_3: 0.0, time_4: 10.0, time_5: 42.0},
{name: '13 de Ene de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 0.0, time_3: 0.0, time_4: 6.0, time_5: 30.0},
{name: '13 de Ene de 2021_2', time_0: 0.0, time_1: 0.0, time_2: 0.0, time_3: 0.0, time_4: 6.0, time_5: 30.0}];
var aAllData = {19_1: [{name: '2 de Jun de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 100.0, time_3: 100.0, time_4: 100.0},
{name: '14 de Ene de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 240.0, time_3: 20.0, time_4: 240.0},
{name: '14 de Ene de 2021_2', time_0: 0.0, time_1: 0.0, time_2: 840.0, time_3: 80.0, time_4: 3360.0},
{name: '13 de Ene de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 600.0, time_3: 60.0, time_4: 1800.0},
{name: '13 de Ene de 2021_2', time_0: 0.0, time_1: 0.0, time_2: 600.0, time_3: 60.0, time_4: 1800.0}], 
19_2: [{name: '2 de Jun de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 0.0, time_3: 0.0, time_4: 1.0, time_5: 1.0},
{name: '14 de Ene de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 0.0, time_3: 0.0, time_4: 1.0, time_5: 12.0},
{name: '14 de Ene de 2021_2', time_0: 0.0, time_1: 0.0, time_2: 0.0, time_3: 0.0, time_4: 10.0, time_5: 42.0},
{name: '13 de Ene de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 0.0, time_3: 0.0, time_4: 6.0, time_5: 30.0},
{name: '13 de Ene de 2021_2', time_0: 0.0, time_1: 0.0, time_2: 0.0, time_3: 0.0, time_4: 6.0, time_5: 30.0}], 
21_1: [{name: '2 de Jun de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 100.0, time_3: 100.0, time_4: 100.0},
{name: '14 de Ene de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 240.0, time_3: 20.0, time_4: 240.0},
{name: '14 de Ene de 2021_2', time_0: 0.0, time_1: 0.0, time_2: 840.0, time_3: 80.0, time_4: 3360.0},
{name: '13 de Ene de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 600.0, time_3: 60.0, time_4: 1800.0},
{name: '13 de Ene de 2021_2', time_0: 0.0, time_1: 0.0, time_2: 600.0, time_3: 60.0, time_4: 1800.0}], 
21_2: [{name: '2 de Jun de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 0.0, time_3: 0.0, time_4: 1.0, time_5: 1.0},
{name: '14 de Ene de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 0.0, time_3: 0.0, time_4: 1.0, time_5: 12.0},
{name: '14 de Ene de 2021_2', time_0: 0.0, time_1: 0.0, time_2: 0.0, time_3: 0.0, time_4: 10.0, time_5: 42.0},
{name: '13 de Ene de 2021_1', time_0: 0.0, time_1: 0.0, time_2: 0.0, time_3: 0.0, time_4: 6.0, time_5: 30.0},
{name: '13 de Ene de 2021_2', time_0: 0.0, time_1: 0.0, time_2: 0.0, time_3: 0.0, time_4: 6.0, time_5: 30.0}], 
24_1: [{name: 'Untitled Category_1', time_0: 0.0, time_1: 0.0, time_2: 2380.0, time_3: 320.0, time_4: 7300.0}], 
24_2: [{name: 'Untitled Category_1', time_0: 0.0, time_1: 0.0, time_2: 0.0, time_3: 0.0, time_4: 24.0, time_5: 115.0}], 
25_1: [{name: 'Untitled Category_1', time_0: 0.0, time_1: 0.0, time_2: 2380.0, time_3: 320.0, time_4: 7300.0}], 
25_2: [{name: 'Untitled Category_1', time_0: 0.0, time_1: 0.0, time_2: 0.0, time_3: 0.0, time_4: 24.0, time_5: 115.0}], 
 }
var dataFormatted = [{name: "13 de Ene de 2021"},
{name: "13 de Ene de 2021"},
{name: "13 de Ene de 2021"},
{name: "13 de Ene de 2021"},
{name: "13 de Ene de 2021"},
{name: "13 de Ene de 2021"},
{name: "14 de Ene de 2021"},
{name: "14 de Ene de 2021"},
{name: "14 de Ene de 2021"},
{name: "14 de Ene de 2021"},
{name: "14 de Ene de 2021"},
{name: "2 de Jun de 2021"}];
var opacityMarked = [];
var indexIgnore = [];
var categoriesX = ["Other", "Other", "Other", "Other", "Other", "Other", "Other", "Other", "Other", "Other", "Other", "Other"];
var drillTableY = [100.00, 240.00, 200.00];
var drillX = ['1622640651','1610620917','1610620588','1610539486','1610539273'];
var limitName = 0;
var isCurrency = true;
var maxValue = 3360;
var minValue = 0;
var maxValue2 = 42;
var minValue2 = 0;
var aMax = [0, 0, 840, 100, 3360];
var aMax2 = [0, 0, 0, 0, 10, 42];
var aCategory = ['Cost','Rate (Cost)','Revenue','Rate (Revenue)','Ticket Total Amount'];
var aCategory2 = ['Available','Inactive','Stocked','Quantity (Cost)','Line Number','Quantity (Revenue)'];
var aCommon = ["Element", "Item", "Stock Number", "Item Type", "Ticket Division", "Invoice", "Ticket Account", "(Ticket Detail) State", "Ticket Type", "Date Created", "Ticket Description", "Date", "Ticket Type ID", "Job End Time", "Job Start Time"];
//endregion

//REGION max letters in name
for (const item in data) {
  var value = data[item].name.length;
  if (limitName < value) {
    limitName = value;
    if (limitName > 10) {
      limitName = 110;
      break;
    } else {
      limitName *= 10;
    }
  }
}
//ENDREGION

//REGION get max value
for (const item in data) {
  var value = data[item].value;
  if (getMaxValue() < value) {
    maxValue = value;
  }
}
//ENDREGION

//The left margin makes the left border visible
var typeChart = TypeEnum.COLUMN;
var digits = digitsCount(getMaxValue());
var _plusSingle = digits == 1 ? 10 : 0;
var _maxValue = (digits * 8) + 35 + _plusSingle;
var _bottom = typeChart == isHorizontal() ? _maxValue : limitName;
var _left = typeChart == isHorizontal() ? limitName : _maxValue;
//width dynamic, height dynamic
var margin = {
  top: 20,
  right: 20,
  bottom: _bottom,
  left: _left
};
var width = 0;
var height = 0;
var isAgain = false;

function setMultiBar() {
  var svg = svgMulti().append('g')
		.attr('transform', `translate(${margin.bottom}, ${margin.top})`);

  var withReduce = width - 100;
	var keys1 = Object.keys(dataTmp[0]);
  const subgroups = keys1.slice(1);

  // List of groups = species here = value of the first column called group -> I show them on the X axis
  const groups = dataTmp.map(d => d.name);

  // Add X axis
  const x = d3.scaleBand()
    .domain(groups)
    .range([height, 0])
    .padding([0.2]);
  var axis = axisMulti(svg, true, x, 0, 5, splitAxis);
  axis = axis
    //Remove line on domain for X axis
    .call(g => g.select('.domain').remove())
    //region set opacity for each tick item
    .call(g => g.selectAll('.tick line')
      .attr('opacity', 0.2))
  completeAxisMultiple(axis, -10, -25, -45);

    // Add Y axis
  const y = d3.scaleLinear()
    .domain([0, getMaxValue()])
    .range([0, withReduce]);

  axis = axisMulti(svg, false, y, height, 0, formatAxis);
  axis = axis
    //Remove line on domain for X axis
    .call(g => g.select('.domain').remove())
    //region set lines by each value for y axis
    .call(
      g => g.selectAll('.tick line')
      .clone()
      .attr('stroke-opacity', 0.1)
      .attr('y2', -height))
  completeAxisMultiple(axis, 10, 10, -45);

  // Another scale for subgroup position?
  const xSubgroup = d3.scaleBand()
    .domain(subgroups)
    .range([x.bandwidth(), 0])
    .padding([0.05]);//TODO CHANGE

    // color palette = one color per subgroup
  const color = d3.scaleOrdinal()
    .domain(subgroups)
    .range(colorPie);

    // Show the bars
  svg.append('g')
    .selectAll('g')
    // Enter in data = loop group per group
    .data(dataTmp)
    .join('g')
      .attr('transform', d => `translate(0, ${x(d.name)})`)
			.attr('id', function(_,i){ return 'item_' + i;})
    .selectAll('rect')
    .data(function(d) { return subgroups.map(function(key) { return {key: key, value: d[key]}; }); })
    .join('rect')
      .attr('x', d => 0)
      .attr('y', d => xSubgroup(d.key))
      .attr('height', xSubgroup.bandwidth())
      .attr('width', d => y(d.value))
      .attr('fill', d => color(d.key))
      .on('click', function () {
        var idParent = this.parentNode.id
        var aData = idParent.split('_')
        if (aData.length > 0)
        {
          var index = aData[1];
          var value = `${drillX[index]}_${index}`;
          drillDown(value)
        }
      });
			
	//Add X axis label:
  addText(svg, 'end', 16, 0, (withReduce / 2) + margin.top, height + margin.bottom - 10, '#808080', axisY, getAxisY(), function () {
    modalCategories(TypeManage.SELECTABLE, this.id);
  });

  //Y axis label:
  addText(svg, 'end', 16, -90, margin.top + (-height / 2), -margin.left - 20, '#808080', axisX, getAxisX(), function () {
    modalCategories(TypeManage.PLAIN, this.id);
  });
	
  var factorBack = margin.top;
	var aCategoryTmp = getMultiCategory();
  if (aCategoryTmp.length - indexIgnore.length >= 3)
  {
    addText(svg, 'start', 16, 0, withReduce + margin.right - 10, 0, '#808080', '', 'Category');
    for (var index = 0; index < aCategoryTmp.length; index++)
    {
      if (!indexIgnore.includes(index)) 
      {
        var item = aCategoryTmp[index];
        addText(svg, 'start', 12, 0, withReduce + margin.right + 10, factorBack, '#808080', `id_${index}`, item, function () {
          var id = this.id;
          adminMulti(id, subgroups);
        });
        addCircle(svg, withReduce + margin.right - 5, factorBack - 5, 5, colorPie[indexCircle(index)], `idcircle_${index}`,
        function () {
          return `opacity: ${opacityMarked.includes(index) ? '0.5' : '1'}`;
        },
        function () {
          var id = this.id;
          adminMulti(id, subgroups);
        });
        factorBack += 20;
      }
    }
  }
}

function setMultiColumn() {
  var svg = svgMulti().append('g')
    .attr('transform', `translate(${margin.left}, ${margin.top})`);

	var withReduce = width - 100;
  var keys1 = Object.keys(dataTmp[0]);
  const subgroups = keys1.slice(1);

  // List of groups = species here = value of the first column called group -> I show them on the X axis
  const groups = dataTmp.map(d => d.name);

  // Add X axis
  const x = d3.scaleBand()
    .domain(groups)
    .range([0, withReduce])
    .padding([0.2]);
  var axis = axisMulti(svg, false, x, height, 5, splitAxis);
	axis = axis
    //Remove line on domain for X axis
    .call(g => g.select('.domain').remove())
    //region set opacity for each tick item
    .call(g => g.selectAll('.tick line')
      .attr('opacity', 0.2))
  completeAxisMultiple(axis, 10, 10, -45);

  // Add Y axis
  const y = d3.scaleLinear()
    .domain([0, getMaxValue()])
    .range([ height, 0 ]);
  axis = axisMulti(svg, true, y, 0, 0, formatAxis);
	axis = axis
    //region set lines by each value for y axis
    .call(
      g => g.selectAll('.tick line')
      .clone()
      .attr('stroke-opacity', 0.1)
      .attr('x2', withReduce))
      .call(g => g.select('.domain').remove())
    completeAxisMultiple(axis, 0, 0, 0);

  // Another scale for subgroup position?
  const xSubgroup = d3.scaleBand()
    .domain(subgroups)
    .range([0, x.bandwidth()])
    .padding([0.05]);

  // color palette = one color per subgroup
  const color = d3.scaleOrdinal()
    .domain(subgroups)
    .range(colorPie);

  // Show the bars
  svg.append('g')
    .selectAll('g')
    // Enter in data = loop group per group
    .data(dataTmp)
    .join('g')
      .attr('transform', d => `translate(${x(d.name)}, 0)`)
			.attr('id', function(_,i){ return 'item_' + i;})
    .selectAll('rect')
    .data(function(d) { return subgroups.map(function(key) { return {key: key, value: d[key]}; }); })
    .join('rect')
      .attr('x', d => xSubgroup(d.key))
      .attr('y', d => y(d.value))
      .attr('width', xSubgroup.bandwidth())
      .attr('height', d => height - y(d.value))
      .attr('fill', d => color(d.key))
      .on('click', function () {
        var idParent = this.parentNode.id;
        var aData = idParent.split('_');
        if (aData.length > 0)
        {
          var index = aData[1];
          var value = `${drillX[index]}_${index}`;
          drillDown(value)
        }
      });
			
	//Add X axis label:
  addText(svg, 'end', 16, 0, (withReduce / 2) + margin.top, height + margin.bottom - 10, '#808080', axisX, getAxisX(), function () {
    modalCategories(TypeManage.PLAIN, this.id);
	});

	//Y axis label:
  addText(svg, 'end', 16, -90, margin.top + (-height / 2), -margin.left + 20, '#808080', axisY, getAxisY(), function () {
    modalCategories(TypeManage.SELECTABLE, this.id);
	});
	
  var factorBack = margin.top;
	var aCategoryTmp = getMultiCategory();
  if (aCategoryTmp.length - indexIgnore.length >= 3)
  {
    addText(svg, 'start', 16, 0, withReduce + margin.right - 10, 0, '#808080', '', 'Category');
    for (var index = 0; index < aCategoryTmp.length; index++)
    {
      if (!indexIgnore.includes(index)) 
      {
        var item = aCategoryTmp[index];
        addText(svg, 'start', 12, 0, withReduce + margin.right + 10, factorBack, '#808080', `id_${index}`, item, function () {
          var id = this.id;
          adminMulti(id, subgroups);
        });
        addCircle(svg, withReduce + margin.right - 5, factorBack - 5, 5, colorPie[indexCircle(index)], `idcircle_${index}`,
        function () {
          return `opacity: ${opacityMarked.includes(index) ? '0.5' : '1'}`;
        },
        function () {
          var id = this.id;
          adminMulti(id, subgroups);
        });
        factorBack += 20;
      }
    }
  }
}

function setMultiLine() {
  var svg = svgMulti().append('g')
    .attr('transform', `translate(${margin.left}, ${margin.top})`);

  var withReduce = width - 100;
	var keys1 = Object.keys(dataTmp[0]);
  const subgroups = keys1.slice(1);
  
  // Reformat the data: we need an array of arrays of {x, y} tuples
  var dataReady = subgroups.map( function(grpName) { // .map allows to do something for each element of the list
    return {
      name: grpName,
      values: dataTmp.map(function(d) {
        return {subname: d.name, value: +d[grpName]};
      })
    };
  });

  var myColor = d3.scaleOrdinal()
    .domain(subgroups)
    .range(colorPie);

    // Add X axis --> it is a date format
  var x = d3.scaleBand()
    .domain(dataTmp.map(function(d) { return d.name; }))
    .range([0, withReduce])
    .padding(1);

  var axis = axisMulti(svg, false, x, height, 10, splitAxis);
  axis = axis
  //Remove line on domain for X axis
  .call(g => g.select('.domain').remove())
  //region set opacity for each tick item
  .call(
    g => g.selectAll('.tick line')
    .attr('opacity', 0.2))
  completeAxisMultiple(axis, 15, 10, -45);

  // Add Y axis
  var y = d3.scaleLinear()
    .domain([0, getMaxValue()])//maxValue is here
    .range([height, 0]);
  var axis = axisMulti(svg, true, y, 0, 0, formatAxis);
	axis = axis
    .call(
      g => g.selectAll('.tick line')
      .clone()
      .attr('stroke-opacity', 0.1)
      .attr('x2', withReduce)
    )
    //Remove line on domain for Y axis
    .call(g => g.select('.domain').remove())
  completeAxisMultiple(axis, 0, 0, 0);

    // Add the lines
  var line = d3.line()
    .x(function(d) { return x(d.subname) })
    .y(function(d) { return y(d.value) });
  svg.selectAll("myLines")
    .data(dataReady)
    .enter()
    .append("path")
      .attr("d", function(d){ return line(d.values) } )
      .attr("stroke", function(d){ return myColor(d.name) })
      .style("stroke-width", 1)
      .style("fill", "none");
			
	// Add the points
  svg
    // First we need to enter in a group
    .selectAll()
    .data(dataReady)
    .enter()
      .append('g')
      .style("fill", function(d){ return myColor(d.name) })
    // Second we need to enter in the 'values' part of this group
    .selectAll()
    .data(function(d){ return d.values })
    .enter()
    .append("circle")
      .attr('id', function(_, i){ return 'item_' + i;})
      .attr("cx", function(d) { return x(d.subname) } )
      .attr("cy", function(d) { return y(d.value) } )
      .attr("r", 5)
      .attr("stroke", "white")
    .on('click', function () {
      var idParent = this.id;
      var aData = idParent.split('_');
      if (aData.length > 0)
      {
        var index = aData[1];
        var value = `${drillX[index]}_${index}`;
        drillDown(value);
      }
    });
		
	//Add X axis label:
  addText(svg, 'end', 16, 0, (withReduce / 2) + margin.top, height + margin.bottom - 10, '#808080', axisX, getAxisX(), function () {
    modalCategories(TypeManage.PLAIN, this.id);
  });

  //Y axis label:
  addText(svg, 'end', 16, -90, margin.top + (-height / 2), -margin.left + 20, '#808080', axisY, getAxisY(), function () {
    modalCategories(TypeManage.SELECTABLE, this.id);
  });
	
  var factorBack = margin.top;
	var aCategoryTmp = getMultiCategory();
  if (aCategoryTmp.length - indexIgnore.length >= 3)
  {
    addText(svg, 'start', 16, 0, withReduce + margin.right - 10, 0, '#808080', '', 'Category');
    for (var index = 0; index < aCategoryTmp.length; index++)
    {
      if (!indexIgnore.includes(index)) 
      {
        var item = aCategoryTmp[index];
        addText(svg, 'start', 12, 0, withReduce + margin.right + 10, factorBack, '#808080', `id_${index}`, item, function () {
          var id = this.id;
          adminMulti(id, subgroups);
        });
        addCircle(svg, withReduce + margin.right - 5, factorBack - 5, 5, colorPie[indexCircle(index)], `idcircle_${index}`,
        function () {
          return `opacity: ${opacityMarked.includes(index) ? '0.5' : '1'}`;
        },
        function () {
          var id = this.id;
          adminMulti(id, subgroups);
        });
        factorBack += 20;
      }
    }
  }
}

function setBar() {
	var svg = d3.select('body').append('svg')
		.attr('width', width + margin.bottom + margin.right)
		.attr('height', height + margin.top + margin.left)
		.append('g')
		.attr('transform', 'translate(' + margin.bottom + ',' + margin.top + ')');

	var x = d3.scaleBand()
		.range([height, 0])
		.padding(0.1);
	var y = d3.scaleLinear()
		.range([0, width]);

	x.domain(data.map(function(d) { return d.name; }));
	y.domain([0, d3.max(data, function(d) { return d.value; })]);

	svg.selectAll()
		.data(data)
		.enter().append('rect')
		.style('fill', function(d) {
			return scaleColorBi(d.value);
		})
		.attr('x', function(d) { return x(d.value); })
		.attr('width', function(d) { return y(d.value); })
		.attr('y', function(d) { return x(d.name); })
		.attr('height', x.bandwidth())
		.on('click', function(_, d) {
			var index = data.indexOf(d);
      var value = drillX[index];
      drillDown(value);
		});

	svg.append('g')
		.attr('transform', 'translate(0,' + height + ')')
		.call(
			d3.axisBottom(y)
			.tickSize(0)
			//format data for each number on Y axis
			.tickFormat(x => `${fformat(x)}`))
		.call(
			g => g.selectAll('.tick line')
			.clone()
			.attr('stroke-opacity', 0.1)
			.attr('y2', -height))
		//Remove line on domain for X axis
		.call(g => g.select('.domain').remove())
		.selectAll('text')
		.attr('transform', 'translate(10,10)rotate(-45)')
		.attr('fill', '#909090');

	svg.append('g')
		.call(
			d3.axisLeft(x)
      .tickFormat(x =>`${getFirst10(x)}`))
		//region set opacity for each tick item
		.call(g => g.selectAll('.tick line')
		.attr('opacity', 0.2))
		//endregion
		//Remove line on domain for Y axis
		.call(g => g.select('.domain').remove())
		.selectAll('text')
		.attr('transform', 'translate(-10,-25)rotate(-45)')
		.attr('fill', '#909090');
	
	  //Add X axis label:
	  addText(svg, 'end', 16, 0, (width / 2) + margin.top, height + margin.left - 10, '#808080', '', axisY);
	
	  //Y axis label:
	  addText(svg, 'end', 16, -90, margin.top + (-height / 2), -margin.bottom + 20, '#808080', '', axisX);
	}

function setColumn() {
  var svg = d3.select('body').append('svg')
    .attr('width', width + margin.left + margin.right)
    .attr('height', height + margin.top + margin.bottom)
    .append('g')
    .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

  var x = d3.scaleBand()
    .range([0, width])
    .padding(0.1);
  var y = d3.scaleLinear()
    .range([height, 0]);

  x.domain(data.map(function(d) { return d.name; }));
  y.domain([0, d3.max(data, function(d) { return d.value; })]);

  svg.selectAll()
    .data(data)
    .enter().append('rect')
    .style('fill', function(d) {
      return scaleColorBi(d.value);
    })
    .attr('x', function(d) { return x(d.name); })
    .attr('width', x.bandwidth())
    .attr('y', function(d) { return y(d.value); })
    .attr('height', function(d) { return height - y(d.value); })
    .on('click', function(_, d) {
      var index = data.indexOf(d);
      var value = drillX[index];
      drillDown(value);
    });

//the X DATA for axis bar
svg.append('g')
  .attr('transform', 'translate(0,' + height + ')')
  .call(
    d3.axisBottom(x)
    .tickFormat(x =>`${getFirst10(x)}`))
  //Remove line on domain for X axis
  .call(g => g.select('.domain').remove())
  //region set opacity for each tick item
  .call(g => g.selectAll('.tick line')
    .attr('opacity', 0.2))
  //endregion
  .selectAll('text')
  //rotate text
  .attr('transform', 'translate(10,10)rotate(-45)')
  //Set color each item on X axis
  .attr('fill', '#909090')
  .style('text-anchor', 'end');

	//the Y DATA for axis bar
	svg.append('g')
	  //Format numbers on axis
	  .call(
	    d3.axisLeft(y)
	    //remove short line for Y axis
	    .tickSize(0)
	    //format data for each number on Y axis
	    .tickFormat(x => `${fformat(x)}`))
	  //region set lines by each value for y axis
	  .call(
	    g => g.selectAll('.tick line')
	    .clone()
	    .attr('stroke-opacity', 0.1)
	    .attr('x2', width))
	  //endregion
	  //Remove line on domain for Y axis
	  .call(g => g.select('.domain').remove())
	  .selectAll('text')
		.attr('transform', 'translate(0,0)rotate(0)')
	  .attr('fill', '#909090');

	//Add X axis label:
  addText(svg, 'end', 16, 0, (width / 2) + margin.top, height + margin.bottom - 10, '#808080', '', axisX);
    
  //Y axis label:
  addText(svg, 'end', 16, -90, margin.top + (-height / 2), -margin.left + 20, '#808080', '', axisY);
}

function setLine() {
  var svg = d3.select('body').append('svg')
    .attr('width', width + margin.left + margin.right)
    .attr('height', height + margin.top + margin.bottom)
    .append('g')
    .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

    // Initialise a X axis:
    var xScaleBand = d3.scaleBand().range([0, width]).padding(1);

    // Initialize an Y axis
    var yScale = d3.scaleLinear().range([height, 0]);

    // create the X axis
    xScaleBand.domain(data.map(function(d) { return d.name; }));
    // create the Y axis
    yScale.domain([0, d3.max(data, function(d) { return d.value }) ]);

    svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(
        d3.axisBottom(xScaleBand)
        .tickFormat(x =>`${getFirst10(x)}`))
      //Remove line on domain for X axis
      .call(g => g.select('.domain').remove())
			//region set opacity for each tick item
			.call(g => g.selectAll('.tick line')
      .attr('opacity', 0.2))
      .selectAll('text')
      //rotate text
      .attr('transform', 'translate(10,10)rotate(-45)')
      //Set color each item on X axis
      .attr('fill', '#909090')
      .style('text-anchor', 'end');

    svg.append("g")
      .call(
        d3.axisLeft(yScale)
        .tickSize(0)
        .tickFormat(x => `${fformat(x)}`))
      //region set lines by each value for y axis
      .call(
        g => g.selectAll('.tick line')
        .clone()
        .attr('stroke-opacity', 0.1)
        .attr('x2', width)
      )
      //Remove line on domain for Y axis
      .call(g => g.select('.domain').remove())
      .selectAll('text')
      .attr('fill', '#909090');

    // Updata the line
    svg.selectAll()
      .data([data], function(d){ return d.value })
      .enter()
      .append("path")
      .attr("d", d3.line()
        .x(function(d) { return xScaleBand(d.name); })
        .y(function(d) { return yScale(d.value); })
        //.curve(d3.curveMonotoneX)
      )
      .attr("stroke", colorBi)
      .attr("stroke-width", 1.5)
      .attr("fill", "none");

    svg.selectAll()
      .data(data)
      .enter()
      .append("circle")
      .attr("cx", function(d) { return xScaleBand(d.name) })
      .attr("cy", function(d) { return yScale(d.value) })
      .attr("r", 5)
      .attr("fill", colorBi)
      .on('click', function(_, d) {
	      var index = data.indexOf(d);
	      var value = drillX[index];
	      drillDown(value);
	    });
			
		//Add X axis label:
    addText(svg, 'end', 16, 0, (width / 2) + margin.top, height + margin.bottom - 10, '#808080', '', axisX);
    //Y axis label:
    addText(svg, 'end', 16, -90, margin.top + (-height / 2), -margin.left + 20, '#808080', '', axisY);
	}

function setDonut() {
  var arc = d3.arc()
    .outerRadius(radius)
		.innerRadius(radius * 0.5);

	var pie = d3.pie()
		.sort(null)
		.value(function(d) {
			return d.value;
		});
		
	var maxWidth = width + margin.left + margin.right;
  var maxHeight = height + margin.top + margin.bottom;

	var svg = d3.select('body').append('svg')
    .attr('width', maxWidth)
    .attr('height', maxHeight)
		.append('g')
		.attr('transform', 'translate(' + maxWidth * 0.65 + ',' + maxHeight * 0.65 + ')');

	var g = svg.selectAll('.arc')
		.data(pie(dataTmp))
		.enter().append('g');

	g.append('path')
		.attr('d', arc)
		.style('fill', function(_, i) {
			return colorPie[i];
		})
		.on('click', function(_, i) {
			var index = i.index;
			var value = drillX[index];
			drillDown(value);
		});
		
	var factorBack = -(maxHeight / 2) - 30;
		
  for (const index in dataFormatted) {
    var item = dataFormatted[index];
    addText(svg, 'start', 12, 0, -(maxWidth / 2) - 20, factorBack, '#808080', `id_${index}`, item.name + ': ' + item.value, function () {
      var id = this.id;
      adminOpacity(id);
    });
		
    addCircle(svg, -(maxWidth / 2) - 30, factorBack - 5, 5, colorPie[index], `idcircle_${index}`,
      function () {
        return `opacity: ${opacityMarked.includes(index) ? '0.5' : '1'}`;
      },
      function () {
        var id = this.id;
        adminOpacity(id);
    });
    factorBack += 20;
  }
}

$('#idTableBasic tfoot th').each(function () {
    var indexInput = $(this).index();
    var title = $(this).text();
    var idInput = title.replace(' ', '_').replace('(', '_').replace(')', '_').replace('&', '_') + '_Basic';
	$(this).html(
        '<input id=' + idInput +
        ' type="text" placeholder="filter column..."/>');

    $("#" + idInput).on('input', function () {
        var filter = $(this).val().toUpperCase();
        var table = document.getElementById("idTableBasic");
        var tr = table.getElementsByTagName("tr");

        for (index = 0; index < tr.length; index++) {
            td = tr[index].getElementsByTagName("td")[indexInput];
            if (td) {
                txtValue = td.textContent || td.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[index].style.display = "";
                } else {
                    tr[index].style.display = "none";
                }
            }
        }
    });
});

$('#idTableDataPivot tfoot th').each(function () {
    var indexInput = $(this).index();
    var title = $(this).text();
    var idInput = title.replace(' ', '_').replace('(', '_').replace(')', '_').replace('&', '_') + '_DataPivot';
	$(this).html(
        '<input id=' + idInput +
        ' type="text" placeholder="Search on ' + title + '"/>');

    $("#" + idInput).on('input', function () {
        var filter = $(this).val().toUpperCase();
        var table = document.getElementById("idTableDataPivot");
        var tr = table.getElementsByTagName("tr");

        for (index = 0; index < tr.length; index++) {
            td = tr[index].getElementsByTagName("td")[indexInput];
            if (td) {
                txtValue = td.textContent || td.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[index].style.display = "";
                } else {
                    tr[index].style.display = "none";
                }
            }
        }
    });
});

function showFilter() {
	var display = $('tfoot').is(':visible') ? 'none' : 'table-header-group';
  $('tfoot').css({'display': display});
}

function adminMulti(id, subgroups) {
  var words = id.split('_');
  var index = parseInt(words[1]);
  var subGroup = subgroups[index];
  var exist = opacityMarked.includes(index);
  if (exist) {
    var tmp = -1;
    for (let _index = 0; _index < opacityMarked.length; _index++) {
      if (index == opacityMarked[_index])
      {
        tmp = _index;
        break;
      }
    }
    opacityMarked.splice(tmp, 1);
  }
  else opacityMarked.push(index);

  var aTmp = getDataMulti();
	for (position in dataTmp) {
    var element = aTmp[position];
		var itEdit = dataTmp[position];
  
		itEdit[subGroup] = exist ? element[subGroup] : 0;
  }
  isAgain = true;
  updateData(typeChart, true);
}

function adminOpacity(id) {
  var words = id.split('_');
  var index = words[1];

  var exist = opacityMarked.includes(index);
  if (exist)
  {
    var tmp = -1;
    for (let _index = 0; _index < opacityMarked.length; _index++) {
      if (index == opacityMarked[_index])
      {
        tmp = _index;
        break;
      }
    }
    var item = data[index];
    dataTmp[index].value = item.value;
    opacityMarked.splice(tmp, 1);
  }
  else 
  {
    dataTmp[index].value = 0;
    opacityMarked.push(index);
  }
  isAgain = true;
  updateData(typeChart, true);
}

function getMaxValue()
{
  if (indexIgnore.length > 0)
  {
    var aTotalIndices = [];
    var aTmp = isCurrency ? aMax : aMax2;
    for (index = 0; index < aTmp.length; index++)
    {
      if (indexIgnore.includes(index)) continue;
      var value = aTmp[index];
      aTotalIndices.push(value);
    }
    var maxMath = Math.max.apply(null, aTotalIndices);
    return maxMath !== 0 ? maxMath : 1;
  }
  else
    return isCurrency ? maxValue : maxValue2;
}

function getMinValue()
{
  return isCurrency ? minValue : minValue2;
}

function getDataMulti()
{
  return isCurrency ? data : data2;
}

function getMultiCategory()
{
  return isCurrency ? aCategory : aCategory2;
}

function indexCircle(index)
{
  return index % colorPie.length;
}

$('td').click(function() {
  var $this = $(this);
  var row = $this.closest('tr').index();
  var column = $this.closest('td').index();
  var firstColumn = $this.closest('tr');
  var finalText = firstColumn[0].firstChild.innerText;
  var strDate = firstColumn[0].children[1].innerText;
	//simple table
  var index = categoriesX.indexOf(finalText);
  finalText = drillX[index];
  //endregion
  drillDown(finalText);
});
var scaleColorBi = d3.scaleOrdinal().range(colorBi);

//region locale settings
var locale = d3.formatLocale({
  "decimal": ",",//","
  "thousands": ",",//" ",
  "grouping": [3],
  "currency": ["$", ""]//["€", ""] first if prefix, second is suffix
});
var fformat = locale.format("$,");
//endregion

$(window).resize(function() {
  updateData(typeChart, true);
});
updateData(typeChart);
</script>
</body>
</html>