<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stacked Area</title>
  <script src="d3.v6.min.js"></script>
</head>
<body>
  <script>
    const data = [{category: 'Barrel', Alberta: 3850.0, null: 0.0, British_Columbia: 0.0, Wyoming: 0.0, New_Mexico: 0.0, Texas: 0.0, Saskatchewan: 0.0, Oklahoma: 0.0, Louisiana: 0.0}, 
{category: 'Hours', Alberta: 981.8, null: 604.9, British_Columbia: 282.0, Wyoming: 282.0, New_Mexico: 52.0, Texas: 34.0, Saskatchewan: 17.0, Oklahoma: 0.0, Louisiana: 0.0}, 
{category: 'Mile', Alberta: 0.0, null: 200.0, British_Columbia: 0.0, Wyoming: 0.0, New_Mexico: 0.0, Texas: 0.0, Saskatchewan: 0.0, Oklahoma: 0.0, Louisiana: 0.0}, 
{category: 'M3', Alberta: 198.0, null: 36.0, British_Columbia: 0.0, Wyoming: 0.0, New_Mexico: 0.0, Texas: 5.0, Saskatchewan: 6.2, Oklahoma: 0.0, Louisiana: 0.0}, 
{category: 'Day', Alberta: 0.0, null: 58.0, British_Columbia: 0.0, Wyoming: 0.0, New_Mexico: 0.0, Texas: 8.0, Saskatchewan: 0.0, Oklahoma: 0.0, Louisiana: 0.0}, 
{category: 'Each', Alberta: 8.0, null: 26.0, British_Columbia: 17.0, Wyoming: 17.0, New_Mexico: 0.0, Texas: 0.0, Saskatchewan: 0.0, Oklahoma: 0.0, Louisiana: 0.0}, 
{category: 'Month', Alberta: 0.0, null: 0.0, British_Columbia: 0.0, Wyoming: 0.0, New_Mexico: 0.0, Texas: 0.0, Saskatchewan: 0.0, Oklahoma: 0.0, Louisiana: 0.0}, 
{category: 'Tonnes', Alberta: 0.0, null: 0.0, British_Columbia: 0.0, Wyoming: 0.0, New_Mexico: 0.0, Texas: 0.0, Saskatchewan: 0.0, Oklahoma: 0.0, Louisiana: 0.0}, 
{category: 'Per 24 Hrs', Alberta: 0.0, null: 0.0, British_Columbia: 0.0, Wyoming: 0.0, New_Mexico: 0.0, Texas: 0.0, Saskatchewan: 0.0, Oklahoma: 0.0, Louisiana: 0.0}, 
{category: 'Square Foot', Alberta: 0.0, null: 0.0, British_Columbia: 0.0, Wyoming: 0.0, New_Mexico: 0.0, Texas: 0.0, Saskatchewan: 0.0, Oklahoma: 0.0, Louisiana: 0.0}];
  const color = ["#26a7e9", "#a5cd39", "#dd6a6a", "#ffa700", "#00c1b2"];
  // Create SVG and padding for the chart
  const svg = d3
    .select('body').append('svg')
    .attr('height', 300)
    .attr('width', 600);

  const strokeWidth = 1.5;
  const margin = { top: 0, bottom: 20, left: 30, right: 20 };
  const chart = svg.append('g').attr('transform', `translate(${margin.left}, 0)`);

  const width = +svg.attr('width') - margin.left - margin.right - strokeWidth * 2;
  const height = +svg.attr('height') - margin.top - margin.bottom;
  const grp = chart
    .append('g')
    .attr('transform', `translate(-${margin.left - strokeWidth},-${margin.top})`);

  var first = data[0];
  var properties = [];
  if (first !== undefined) {
    var keys1 = Object.keys(first);
    keys1.map(function(b1) {
      if (b1 != 'category' && properties.indexOf(b1) === -1) {
        properties.push(b1);
      }
    }); 
  }

  // Create stack
  const stack = d3.stack().keys(properties);
  const stackedValues = stack(data);
  const stackedData = [];
  // Copy the stack offsets back into the data.
  stackedValues.forEach((layer, index) => {
    const currentStack = [];
    layer.forEach((d, i) => {
      currentStack.push({
        values: d,
        category: data[i].category
      });
    });
    stackedData.push(currentStack);
  });

  // Create scales
  const yScale = d3
    .scaleLinear()
    .range([height, 0])
    .domain([
      0,
      d3.max(stackedValues[stackedValues.length - 1], dp => dp[1])]
    );
  const xScale = d3
    //use for to scale from start to final
    .scalePoint()
    .range([0, width])
    .domain(
      data.map(function(d) { return d.category; })
    )

  const area = d3
    .area()
    .x(dataPoint => xScale(dataPoint.category))
    .y0(dataPoint => yScale(dataPoint.values[0]))
    .y1(dataPoint => yScale(dataPoint.values[1]));

  const series = grp
    .selectAll('.series')
    .data(stackedData)
    .enter()
    .append('g')
    .attr('class', 'series');

  series
    .append('path')
    .attr('transform', `translate(${margin.left},0)`)
    .style('fill', (_, i) => color[i])
    .attr('d', d => area(d));

  // Add the X Axis
  chart
    .append('g')
    .attr('transform', `translate(0,${height})`)
    .call(
      d3
      .axisBottom(xScale)
    );

  // Add the Y Axis
  chart
    .append('g')
    .attr('transform', `translate(0, 0)`)
    .call(d3.axisLeft(yScale));
  </script>
</body>
</html>